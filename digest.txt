Directory structure:
└── open-youlearn.ai/
    ├── README.md
    ├── index.html
    ├── learn.html
    ├── package.json
    ├── script.js
    ├── server.js
    ├── styles.css
    ├── test.html
    ├── test.js
    ├── vercel.json
    ├── api/
    │   └── transcript/
    │       └── [videoId].js
    └── .vercel/
        ├── README.txt
        └── project.json

================================================
File: README.md
================================================
# open-youlearn.ai

================================================
File: index.html
================================================
<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>YouLearn</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --background: #ffffff;
        --foreground: #0f172a;
        --card: #ffffff;
        --border: #e2e8f0;
        --input: #e2e8f0;
      }

      .dark {
        --background: #000000;
        --foreground: #ffffff;
        --card: #121212;
        --border: #1e1e1e;
        --input: #1e1e1e;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background-color: var(--background);
        color: var(--foreground);
        min-height: 100vh;
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      .container {
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 1rem;
      }

      .title {
        font-size: 2.5rem;
        margin-bottom: 2rem;
        text-align: center;
        transform: translateY(0);
        opacity: 1;
        transition: transform 0.5s ease, opacity 0.5s ease;
      }

      .title.animate {
        transform: translateY(-20px);
        opacity: 0;
      }

      .input-wrapper {
        width: 100%;
        max-width: 600px;
        display: flex;
        background-color: var(--card);
        border-radius: 1rem;
        border: 1px solid var(--border);
        padding: 1rem;
        transform: scale(1);
        transition: transform 0.3s ease, background-color 0.3s ease,
          border-color 0.3s ease;
      }

      .input-wrapper:focus-within {
        transform: scale(1.02);
      }

      .input-field {
        flex: 1;
        background: transparent;
        border: none;
        color: var(--foreground);
        font-size: 1rem;
        outline: none;
        transition: color 0.3s ease;
      }

      .input-field::placeholder {
        color: #94a3b8;
      }

      .submit-button {
        background-color: var(--foreground);
        border: none;
        border-radius: 0.75rem;
        padding: 0.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-left: 0.5rem;
        transition: transform 0.2s ease, background-color 0.3s ease;
      }

      .submit-button:hover {
        transform: scale(1.1);
      }

      .submit-button svg {
        stroke: var(--background);
        transition: stroke 0.3s ease;
      }

      @media (max-width: 640px) {
        .title {
          font-size: 2rem;
        }

        .input-wrapper {
          margin: 0 1rem;
        }
      }
    </style>
  </head>
  <body>
    <main class="container">
      <h1 class="title">Hôm nay bạn muốn học gì?</h1>

      <div class="input-wrapper">
        <input
          type="text"
          class="input-field"
          placeholder="Tải tệp lên, dán video YouTube hoặc ghi lại bài giảng"
        />
        <button class="submit-button">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M5 12h14"></path>
            <path d="m12 5 7 7-7 7"></path>
          </svg>
        </button>
      </div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const themeToggle = document.getElementById("themeToggle");
        const title = document.querySelector(".title");

        // Lấy trạng thái theme từ localStorage
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark") {
          document.body.classList.add("dark");
        }

        // Toggle theme & lưu trạng thái
        themeToggle.addEventListener("click", () => {
          title.classList.add("animate");

          setTimeout(() => {
            document.body.classList.toggle("dark");
            const isDark = document.body.classList.contains("dark");
            localStorage.setItem("theme", isDark ? "dark" : "light");

            title.classList.remove("animate");
          }, 300);
        });
      });

      // Hàm lấy videoId từ URL YouTube
      function getYouTubeVideoId(url) {
        // Biểu thức chính quy để lấy video ID từ các dạng URL khác nhau của YouTube
        var regExp =
          /^.*((youtu\.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;
        var match = url.match(regExp);
        if (match && match[7].length === 11) {
          return match[7];
        }
        return null;
      }

      const input_field = document.querySelector(".input-field");
      const submit_button = document.querySelector(".submit-button");

      submit_button.addEventListener("click", () => {
        localStorage.setItem("videoId", getYouTubeVideoId(input_field.value));
        window.location.href = "learn.html";
      });
    </script>
  </body>
</html>

================================================
File: learn.html
================================================
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouLearn - Learn</title>
    <link rel="shortcut icon" href="./logo.svg" type="image/x-icon">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.5/split.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h1 class="logo">YouLearn</h1>
                <button id="sidebarToggle" class="btn-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </button>
            </div>
            <nav class="sidebar-nav">
                <button class="btn btn-ghost new"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg><span>Tạo mới</span></button>
                <button class="btn btn-ghost"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg><span>Lịch sử</span></button>
                <button class="btn btn-ghost"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><span>Gần đây</span></button>
            </nav>
            <div class="sidebar-footer">
                <button id="themeToggle" class="btn btn-ghost">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
                    <span>Chuyển đổi giao diện</span>
                </button>
                <button id="settings" class="btn btn-ghost"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg><span>Cài đặt</span></button>
            </div>
        </aside>

        <!-- Main content -->
        <main class="main-content">
            <div id="leftPanel" class="left-panel">
                <div class="video-player">
                    <div class="video-container"></div>
                </div>
                <div class="transcript-chapters">
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="chapters">Chapters</button>
                        <button class="tab-btn" data-tab="transcript">Transcript</button>
                    </div>
                    <div id="chaptersContent" class="tab-content active">
                        <button class="regenerate-btn chapters-btn">
                            <i class="fas fa-sitemap"></i>
                            <span>Tạo mục lục</span>
                            <div class="galaxy-spinner"></div>
                        </button>
                        <div class="chapter-list">
                        </div>
                    </div>
                    <div id="transcriptContent" class="tab-content">
                        <div class="transcript">
                        </div>
                    </div>
                </div>
            </div>
            <div id="rightPanel" class="right-panel">
                <div class="ai-section">
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="chat">Trò chuyện</button>
                        <button class="tab-btn" data-tab="flashcard">Flashcard</button>
                        <button class="tab-btn" data-tab="summary">Tóm tắt</button>
                    </div>
                    <div id="chatContent" class="tab-content active">
                        <div id="messages" class="chat-messages"></div>
                        <div class="chat-input-container">
                            <input id="input" type="text" placeholder="Nhập tin nhắn..." class="chat-input">
                            <button id="send" class="chat-send">Gửi</button>
                        </div>
                    </div>
                    <div id="flashcardContent" class="tab-content">
                        <button class="regenerate-btn flashcard-btn">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Tạo Flashcard</span>
                            <div class="galaxy-spinner"></div>
                        </button>
                    </div>
                    <div id="summaryContent" class="tab-content">
                        <button class="regenerate-btn summary-btn">
                            <i class="fas fa-book-reader"></i>
                            <span>Tạo bản tóm tắt</span>
                            <div class="galaxy-spinner"></div>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module" src="script.js"></script>
</body>
</html>

================================================
File: package.json
================================================
{
  "name": "open-youlearn.ai",
  "type": "module",
  "dependencies": {
    "@google/generative-ai": "^0.21.0",
    "cors": "^2.8.5",
    "express": "^4.21.2",
    "youtube-transcript": "^1.2.1"
  },
  "devDependencies": {},
  "engines": {
    "node": ">=18.0.0"
  }
}


================================================
File: script.js
================================================
import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

const API_URL = window.location.hostname === 'localhost' 
  ? 'http://localhost:3000'
  : 'https://open-youlearn-ai.vercel.app';

// Initialize API clients
const apiKey = "AIzaSyA6nRUwDozn7hYsRbqGXAtWwm1QU09Umwk";
const genAI = new GoogleGenerativeAI(apiKey);

const generationConfig = {
  temperature: 0.5,
  topP: 0.8,
  topK: 5,
  maxOutputTokens: 8192,
  responseMimeType: "text/plain",
};

const systemInstructionYouLearn = `
Bạn là YouLearn, một AI dạy học. Dựa trên thông tin được cung cấp, hãy tạo ra một phản hồi hữu ích và toàn diện nhất có thể.  Hãy đảm bảo câu trả lời chính xác, đầy đủ thông tin và được trình bày rõ ràng.  Vui lòng sử dụng ngôn ngữ lịch sự và chuyên nghiệp, tránh ngôn ngữ không phù hợp. Sử dụng Markdown để định dạng văn bản để tăng cường khả năng đọc và làm rõ cấu trúc.  Cụ thể hơn, hãy:

* **Ưu tiên tính chính xác và rõ ràng:**  Xác minh thông tin khi có thể và trình bày một cách dễ hiểu.
* **Cung cấp ngữ cảnh và giải thích:**  Đừng chỉ đưa ra câu trả lời; hãy giải thích lý do tại sao đó là câu trả lời đúng và cung cấp ngữ cảnh liên quan.
* **Sử dụng ví dụ minh họa:**  Khi thích hợp, hãy sử dụng ví dụ để minh họa các khái niệm và làm cho chúng dễ tiếp cận hơn.
* **Cấu trúc câu trả lời của bạn:** Sử dụng các tiêu đề, danh sách, bảng và các yếu tố định dạng khác để tổ chức thông tin và cải thiện khả năng đọc.
* **Duy trì giọng điệu dạy học:**  Hãy kiên nhẫn, khuyến khích và tập trung vào việc giúp người học hiểu tài liệu.
* **Chỉ trả lời dựa trên thông tin được cung cấp:**  Nếu không có đủ thông tin để trả lời đầy đủ, hãy nêu rõ điều đó và cho biết thông tin nào còn thiếu.  Tránh suy đoán hoặc bịa đặt thông tin.
* **Đề xuất các nguồn bổ sung (nếu có):**  Nếu có các nguồn bổ sung liên quan, hãy cung cấp các liên kết hoặc tài liệu tham khảo để người học có thể tìm hiểu thêm.

Bằng cách làm theo các hướng dẫn này, bạn có thể cung cấp trải nghiệm học tập hiệu quả và bổ ích.  
`;

const systemInstructionSummary = `
# Hãy tạo một bản tóm tắt chi tiết và toàn diện nhất có thể về các sự kiện, thông tin và kiến thức được trình bày trong video. Bản tóm tắt này KHÔNG PHẢI là một danh sách liệt kê tất cả các sự kiện, mà là một bản tóm tắt có cấu trúc, nhóm các sự kiện liên quan lại với nhau thành các chủ đề lớn.
# Nếu đang tạo mục lục cho video, hãy đảm bảo timestamp và nội dung phải trùng khớp với phần <transcript> đã được cung cấp.
`;

const model = genAI.getGenerativeModel({ 
  model: "gemini-2.0-flash", 
  tools: [{ googleSearch: {} }],
  generationConfig,
  systemInstruction: systemInstructionYouLearn
});

const summaryModel = genAI.getGenerativeModel({ 
  model: "gemini-2.0-flash", 
  tools: [{ googleSearch: {} }],
  generationConfig,
  systemInstruction: systemInstructionSummary 
});

let player;
let chatSession;
let chatHistory = []; // Lưu trữ lịch sử chat

// Biến toàn cục cho flashcards
let currentCardIndex = 0;
let flashcards = [];

// Khai báo biến toàn cục để lưu trữ dữ liệu transcript
let fullTextForChapters = '';
let summaryPrompt = '';

// Khi DOM đã sẵn sàng
document.addEventListener("DOMContentLoaded", () => {
  // Button "New"
  const newBtn = document.querySelector(".new");
  newBtn && newBtn.addEventListener("click", () => window.location.href = "index.html");

  // Sidebar, theme toggle, tab switching, và split panel
  const sidebar = document.getElementById("sidebar");
  const sidebarToggle = document.getElementById("sidebarToggle");
  const themeToggle = document.getElementById("themeToggle");

  // Thiết lập theme và trạng thái sidebar từ localStorage
  document.body.classList.toggle("dark", localStorage.getItem("theme") === "dark");
  const collapsed = localStorage.getItem("sidebarCollapsed") === "true";
  sidebar?.classList.toggle("collapsed", collapsed);
  updateSidebarIcon(collapsed);

  sidebarToggle?.addEventListener("click", () => {
    const isCollapsed = sidebar.classList.toggle("collapsed");
    localStorage.setItem("sidebarCollapsed", isCollapsed);
    updateSidebarIcon(isCollapsed);
  });

  themeToggle?.addEventListener("click", () => {
    const isDark = document.body.classList.toggle("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  });

  // Cấu hình chuyển đổi tab cho các section
  setupTabs(".transcript-chapters .tab-btn", ".transcript-chapters .tab-content");
  setupTabs(".ai-section .tab-btn", ".ai-section .tab-content");

  function setupTabs(btnSelector, contentSelector) {
    const buttons = document.querySelectorAll(btnSelector);
    const contents = document.querySelectorAll(contentSelector);
    buttons.forEach(button => {
      button.addEventListener("click", () => {
        buttons.forEach(btn => btn.classList.remove("active"));
        contents.forEach(c => c.classList.remove("active"));
        button.classList.add("active");
        document.getElementById(`${button.dataset.tab}Content`)?.classList.add("active");
      });
    });
  }

  function updateSidebarIcon(isCollapsed) {
    sidebarToggle.innerHTML = isCollapsed
      ? `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
           <path d="m9 18 6-6-6-6"/>
         </svg>`
      : `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
           <path d="m15 18-6-6 6-6"/>
         </svg>`;
  }

  // Cấu hình Split (yêu cầu thư viện Split được import)
  if (typeof Split === "function") {
    Split(["#leftPanel", "#rightPanel"], {
      sizes: [50, 50],
      minSize: [600, 350],
      gutterSize: 1,
      cursor: "col-resize"
    });
  }

  // Cấu hình sự kiện cho chat UI
  const input = document.getElementById("input");
  const sendBtn = document.getElementById("send");
  sendBtn && sendBtn.addEventListener("click", sendMessage);
  input && input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") sendMessage();
  });

  // Setup regenerate buttons
  setupRegenerateButtons();
  
  // Khởi tạo container flashcard
  initFlashcardContainer();
});

// Hàm khởi tạo container flashcard
function initFlashcardContainer() {
  const flashcardContent = document.getElementById('flashcardContent');
  if (!flashcardContent) return;

  const container = document.createElement('div');
  container.id = 'flashcardContainer';
  container.innerHTML = `
    <div id="flashcardControls">
      <button id="prevCard" class="btn btn-ghost" aria-label="Previous card">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m15 18-6-6 6-6"/>
        </svg>
      </button>
      <span id="cardCounter">0/0</span>
      <button id="nextCard" class="btn btn-ghost" aria-label="Next card">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m9 18 6-6-6-6"/>
        </svg>
      </button>
    </div>
    <div class="flashcard">
      <div class="flashcard-inner">
        <div class="flashcard-front">
          <div class="question">
            <p><br><br><br>Nhấn vào nút "Tạo Flashcard" để bắt đầu<br><br><br></p>
          </div>
          <button class="btn btn-ghost hint-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
              <path d="M12 17h.01"/>
            </svg>
            Gợi ý
          </button>
          <div class="hint"></div>
        </div>
        <div class="flashcard-back">
          <div class="answer"></div>
          <button class="btn btn-ghost explanation-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="16" x2="12" y2="12"/>
              <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            Giải thích
          </button>
          <div class="explanation">
            <div class="source"></div>
          </div>
        </div>
      </div>
    </div>
  `;
  
  flashcardContent.appendChild(container);
}

function setupRegenerateButtons() {
  const regenerateButtons = document.querySelectorAll('.regenerate-btn');
  regenerateButtons.forEach(btn => {
    btn.addEventListener('click', async () => {
      if (btn.classList.contains('loading')) return;
      
      // Add cosmic generation effect
      btn.classList.add('loading', 'cosmic-effect');
      
      try {
        if (btn.classList.contains('chapters-btn')) {
          if (!fullTextForChapters) {
            throw new Error('Transcript data not loaded yet');
          }
          const chaptersData = await generateChapters(fullTextForChapters);
          if (chaptersData && chaptersData.chapters) {
            renderChapters(chaptersData.chapters);
          }
        } else if (btn.classList.contains('flashcard-btn')) {
          if (!fullTextForChapters) {
            throw new Error('Transcript data not loaded yet');
          }
          const flashcardsData = await generateFlashcards(fullTextForChapters);
          if (flashcardsData && flashcardsData.flashcards) {
            initFlashcards(flashcardsData.flashcards);
          }
        } else if (btn.classList.contains('summary-btn')) {
          if (!summaryPrompt) {
            throw new Error('Summary prompt not generated yet');
          }
          const summaryResult = await summaryModel.generateContent(summaryPrompt);
          const summaryResponse = await summaryResult.response;
          let summaryText = await summaryResponse.text();
          summaryText = summaryText.replace(/\n{3,}/g, "\n\n").trim();
          document.getElementById('summaryContent').innerHTML = marked.parse(summaryText);
        }
        // After regeneration completes, hide the button
        btn.style.display = 'none';
      } catch (error) {
        console.error('Error regenerating content:', error);
        alert(error.message || 'Đã xảy ra lỗi khi tạo nội dung');
      } finally {
        // Remove cosmic generation effect after completion
        btn.classList.remove('loading', 'cosmic-effect');
      }
    });
  });
}

// Khởi tạo YouTube API
function initYouTubeAPI() {
  const tag = document.createElement("script");
  tag.src = "https://www.youtube.com/iframe_api";
  document.head.appendChild(tag);
}

window.onYouTubeIframeAPIReady = () => {
  const videoId = localStorage.getItem("videoId");
  if (videoId) {
    player = new YT.Player("youtube-player", {
      videoId,
      events: { onReady }
    });
  }
};

function onReady() {
  console.log("Player is ready");
}

// Hàm tạo chapters (mục lục) sử dụng AI
async function generateChapters(transcript) {
  const chapterPrompt = `
Hãy tạo ra các chapter (mục lục) cho video này dựa trên transcript. Trả về dữ liệu dưới dạng JSON với định dạng sau:
{
  "chapters": [
    {
      "title": "Tiêu đề của mục",
      "summary": "Tóm tắt ngắn gọn nội dung của mục này",
      "start": "Thời điểm bắt đầu (số giây)",
      "end": "Thời điểm kết thúc (số giây)"
    }
  ]
}

Lưu ý:
- Chỉ trả về JSON, không kèm markdown
- Mỗi chapter nên có độ dài hợp lý (tối thiểu 30 giây)
- Tóm tắt nên ngắn gọn, súc tích
- Thời gian start/end phải là số (không phải chuỗi) và phải chính xác với cột mốc tối đa của video.
- Ngôn ngữ: Tiếng Việt

Transcript:
<transcript>
${transcript}
</transcript>
`;

  try {
    const result = await summaryModel.generateContent(chapterPrompt);
    const response = await result.response;
    const text = await response.text();
    // Lấy JSON từ kết quả (loại bỏ markdown nếu có)
    const jsonMatch = text.match(/\{(?:[^{}]|\{(?:[^{}]|\{[^{}]*\})*\})*\}/);
    if (!jsonMatch) throw new Error("No JSON found in response");
    return JSON.parse(jsonMatch[0]);
  } catch (error) {
    console.error("Error generating chapters:", error);
    return null;
  }
}

// Hàm render chapters lên giao diện
function renderChapters(chapters) {
  const chapterList = document.querySelector(".chapter-list");
  if (!chapterList) return;
  chapterList.innerHTML = chapters
    .map(
      (chapter) => `
    <div class="chapter-item" data-time="${chapter.start}">
      <div class="chapter-header">
        <span class="timestamp">${formatTime(chapter.start)}</span> - 
        <span class="timestamp">${formatTime(chapter.end)}</span>
      </div>
      <div class="chapter-content">
        <h3>${chapter.title}</h3>
        <p>${chapter.summary}</p>
      </div>
    </div>
  `
    )
    .join("");

  // Thêm sự kiện click cho từng chapter
  chapterList.querySelectorAll(".chapter-item").forEach((item) => {
    item.addEventListener("click", () => {
      const time = parseFloat(item.dataset.time);
      if (player && typeof player.seekTo === "function") {
        player.seekTo(time, true);
        player.playVideo();
      }
    });
  });
}

// Ước tính số token (giả sử trung bình 4 ký tự = 1 token)
function estimateTokenCount(text) {
  return Math.ceil(text.length / 4);
}

// Giản lược transcript nếu quá dài
function simplifyTranscript(transcript, maxTokens = 25000) {
  const combinedText = transcript.map((item) => item.text).join(" ");
  const estimatedTokens = estimateTokenCount(combinedText);
  if (estimatedTokens <= maxTokens) return transcript;

  const reductionFactor = Math.ceil(estimatedTokens / maxTokens);
  const importantMarkers = [
    "đầu tiên",
    "thứ nhất",
    "thứ hai",
    "tiếp theo",
    "cuối cùng",
    "tóm lại",
    "kết luận",
    "tổng kết",
    "ví dụ",
    "điều quan trọng",
    "lưu ý",
    "chú ý",
    "bây giờ",
    "vậy là",
  ];

  return transcript.filter((item, index) => {
    if (index === 0 || index === transcript.length - 1) return true;
    if (importantMarkers.some((marker) => item.text.toLowerCase().includes(marker)))
      return true;
    return index % reductionFactor === 0;
  });
}

// Hàm load video, transcript, tạo chapters và tóm tắt
async function loadVideo() {
  const videoId = localStorage.getItem("videoId");
  if (!videoId) {
    alert("URL không hợp lệ. Vui lòng nhập URL dạng watch của YouTube!");
    return;
  }
  document.querySelector(".video-container").innerHTML = `<div id="youtube-player"></div>`;
  initYouTubeAPI();

  const transcriptEl = document.querySelector(".transcript");

  try {
    console.log('Fetching transcript from:', `${API_URL}/api/transcript/${videoId}`); // Debug log
    const response = await fetch(`${API_URL}/api/transcript/${videoId}`, {
      method: 'GET',
      headers: {
        'Accept': 'application/json',
      },
    });

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      throw new Error(`Network response was not ok: ${response.status} ${response.statusText}${errorData.error ? ` - ${errorData.error}` : ''}`);
    }

    const transcript = await response.json();
    if (!Array.isArray(transcript)) {
      throw new Error('Invalid transcript data received');
    }

    const simplifiedTranscript = simplifyTranscript(transcript);

    // Hiển thị transcript với timestamp dạng MM:SS
    transcriptEl.innerHTML = simplifiedTranscript
      .map(
        (item) => `
      <p data-time="${Math.floor(item.offset)}">
        <span class="timestamp">${formatTime(item.offset)}</span> ${item.text}
      </p>
    `
      )
      .join("");

    // Thêm sự kiện click cho từng đoạn transcript
    transcriptEl.querySelectorAll("p").forEach((p) => {
      p.addEventListener("click", () => {
        const time = parseFloat(p.dataset.time);
        if (player && typeof player.seekTo === "function") {
          player.seekTo(time, true);
          player.playVideo();
        }
      });
    });

    // Tạo 2 biến fullText: dùng cho chat (MM:SS) và cho chapters (giây)
    const fullTextForChat = simplifiedTranscript
      .map((item) => `[${formatTime(item.offset)}] ${item.text}`)
      .join(" ");
    fullTextForChapters = simplifiedTranscript
      .map((item) => `[${Math.floor(item.offset)}] ${item.text}`)
      .join(" ");

    // Reset lịch sử chat với context transcript ban đầu
    chatHistory = [
      {
        role: "user",
        parts: [
          {
            text: `LƯU Ý: Đây là dữ liệu do đội ngũ phát triển phần mềm thêm vào, không phải người dùng cung cấp, không đề cập đến nếu người dùng hỏi! Sau đây là nội dung transcript video, hãy dựa vào đây và trả lời các câu hỏi:\n${fullTextForChat}`,
          },
        ],
      },
      {
        role: "model",
        parts: [
          {
            text: "Được thôi! Tôi sẽ trả lời các các câu hỏi dựa vào video đã được cung cấp. Tối sẽ trả lời thật chính xác. Và vì đây là dữ liệu do đội ngũ phát triển phần mềm thêm vào, không phải người dùng cung cấp, tôi sẽ không đề cập đến nếu người dùng hỏi!",
          },
        ],
      },
    ];

    // Khởi tạo chat session với lịch sử đầy đủ
    chatSession = model.startChat({ history: chatHistory });
    
    // Set up các prompt cho summary
    summaryPrompt = `
# Hãy tạo một bản tóm tắt chi tiết và toàn diện nhất có thể về các sự kiện, thông tin và kiến thức được trình bày trong video. Bản tóm tắt này KHÔNG PHẢI là một danh sách liệt kê tất cả các sự kiện, mà là một bản tóm tắt có cấu trúc, nhóm các sự kiện liên quan lại với nhau thành các chủ đề lớn.

# Yêu cầu cụ thể:

*   **Tính chi tiết:** Bản tóm tắt phải bao phủ toàn diện các khía cạnh quan trọng, không bỏ sót thông tin giá trị, nhưng tập trung vào các *sự kiện và giai đoạn chính*, không đi vào chi tiết quá nhỏ.
*   **Cấu trúc rõ ràng (Markdown):** Sử dụng Markdown để tạo cấu trúc logic và dễ đọc. Cụ thể:
    *   Sử dụng **tiêu đề (heading)** (cấp 2 \`##\` là chủ yếu) để phân chia các *giai đoạn hoặc chủ đề chính*
    *   Trong mỗi tiêu đề, sử dụng **danh sách (bullet points)** để tóm tắt *các sự kiện hoặc diễn biến quan trọng nhất* liên quan đến chủ đề đó.  **Hạn chế nghiêm ngặt:**
        *   Mỗi bullet point nên tóm tắt *một cụm sự kiện/diễn biến liên quan*, không phải một sự kiện đơn lẻ.
        *   KHÔNG liệt kê quá nhiều sự kiện chi tiết.
        *   TUYỆT ĐỐI KHÔNG sử dụng danh sách lồng nhau.
        *   Giữ cho mỗi bullet point ngắn gọn (tối đa 1 câu).
    *   Sử dụng **in đậm (bold)** cho các thuật ngữ, khái niệm, hoặc kết luận quan trọng.
    *   Sử dụng **gạch nghiêng (italics)** cho các ví dụ ngắn, trích dẫn.
*   **Tính chính xác:** Tuyệt đối chính xác và trung thực với nội dung video.
*   **Tính khách quan:** Trình bày thông tin khách quan, không thêm ý kiến cá nhân.
*   **Độ dài phù hợp:** Đảm bảo tính chi tiết nhưng vẫn ngắn gọn, súc tích.
*   **KHÔNG có Timeline:** đối không hiển thị timeline.
*   **KHÔNG có Câu mở đầu:** Tuyệt đối không đưa ra các câu dẫn ở đầu
*   **Phong cách:** Sử dụng văn phong tóm tắt, súc tích, tập trung vào các điểm chính. Tránh lặp lại thông tin.
*   **Ngôn ngữ:** Tiếng Việt.

# Định dạng Output:
Markdown, tuân thủ chặt chẽ các yêu cầu trên.

# Transcript:
<transcript>
${fullTextForChat}
</transcript>      
`;

  } catch (error) {
    console.error("Error fetching transcript:", error);
    alert("Đã xảy ra lỗi khi tải transcript. Vui lòng thử lại.");
  }
}

// Hàm định dạng thời gian từ giây sang [DD:]HH:MM:SS
function formatTime(seconds) {
  const d = Math.floor(seconds / 86400),
    h = Math.floor((seconds % 86400) / 3600),
    m = Math.floor((seconds % 3600) / 60),
    s = Math.floor(seconds % 60);
  let result = "";
  if (d > 0) result += `${d}:`;
  if (h > 0 || d > 0) result += `${h.toString().padStart(2, "0")}:`;
  result += `${m.toString().padStart(2, "0")}:${s.toString().padStart(2, "0")}`;
  return result;
}

// Các hàm xử lý giao diện chat
function addMessage(text, isUser) {
  const messages = document.getElementById("messages");
  if (!messages) return;
  const div = document.createElement("div");
  div.className = isUser ? "message user" : "message bot";
  div.innerHTML = marked.parse(text);
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

async function sendMessage() {
  const input = document.getElementById("input");
  const text = input.value.trim();
  if (!text) return;

  // Thêm tin nhắn của người dùng
  chatHistory.push({ role: "user", parts: [{ text }] });
  addMessage(text, true);
  input.value = "";

  try {
    const response = await chatSession.sendMessageStream(text);
    let reply = "";
    for await (const chunk of response.stream) {
      reply += chunk.text().replace(/\n{3,}/g, "\n\n");
    }
    reply = reply.trim();
    chatHistory.push({ role: "model", parts: [{ text: reply }] });
    addMessage(reply, false);
    // Tạo lại chat session với lịch sử cập nhật để duy trì context
    chatSession = model.startChat({ history: chatHistory });
  } catch (error) {
    console.error("Error sending message:", error);
    addMessage("Xin lỗi, đã có lỗi xảy ra. Vui lòng thử lại.", false);
  }
}

// Hàm tạo flashcards từ transcript sử dụng AI
async function generateFlashcards(transcript) {
  const flashcardPrompt = `
Hãy tạo ra các flashcard cho video này dựa trên transcript. Trả về dữ liệu dưới dạng JSON với định dạng sau:
{
  "flashcards": [
    {
      "question": "Câu hỏi",
      "hint": "Gợi ý để giúp người học nhớ câu trả lời",
      "answer": "Câu trả lời",
      "explanation": "Giải thích chi tiết tại sao đây là câu trả lời đúng",
      "timestamp": "Thời điểm trong video đề cập đến nội dung này (số giây)"
    }
  ]
}

Lưu ý:
- Chỉ trả về JSON, không kèm markdown
- Mỗi flashcard phải là một khái niệm hoặc ý tưởng quan trọng từ video
- Câu hỏi nên ngắn gọn, súc tích và rõ ràng
- Gợi ý nên giúp người học suy nghĩ về câu trả lời mà không tiết lộ hoàn toàn
- Giải thích phải đầy đủ và có ý nghĩa giáo dục
- Timestamp phải là số (không phải chuỗi)
- Ngôn ngữ: Tiếng Việt

Transcript:
<transcript>
${transcript}
</transcript>
`;

  try {
    const result = await summaryModel.generateContent(flashcardPrompt);
    const response = await result.response;
    const text = await response.text();
    const jsonMatch = text.match(/\{(?:[^{}]|\{(?:[^{}]|\{[^{}]*\})*\})*\}/);
    if (!jsonMatch) throw new Error("No JSON found in response");
    return JSON.parse(jsonMatch[0]);
  } catch (error) {
    console.error("Error generating flashcards:", error);
    return null;
  }
}

// Hàm render và xử lý tương tác flashcard
function initFlashcards(cards) {
  flashcards = cards;
  currentCardIndex = 0;
  updateFlashcardDisplay();

  // Xử lý sự kiện click cho nút điều hướng
  document.getElementById('prevCard').addEventListener('click', () => {
    if (currentCardIndex > 0) {
      currentCardIndex--;
      updateFlashcardDisplay();
    }
  });

  document.getElementById('nextCard').addEventListener('click', () => {
    if (currentCardIndex < flashcards.length - 1) {
      currentCardIndex++;
      updateFlashcardDisplay();
    }
  });

  // Xử lý sự kiện lật flashcard
  const flashcard = document.querySelector('.flashcard');
  flashcard.addEventListener('click', (e) => {
    if (!e.target.matches('button')) {
      flashcard.classList.toggle('flipped');
    }
  });

  // Xử lý sự kiện hiển thị gợi ý và giải thích
  const hintBtn = document.querySelector('.hint-btn');
  const explanationBtn = document.querySelector('.explanation-btn');

  hintBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    const hint = e.target.parentElement.querySelector('.hint');
    hint.style.display = hint.style.display === 'block' ? 'none' : 'block';
  });

  explanationBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    const explanation = e.target.parentElement.querySelector('.explanation');
    explanation.style.display = explanation.style.display === 'block' ? 'none' : 'block';
  });
}

// Hàm cập nhật nội dung flashcard
function updateFlashcardDisplay() {
  if (flashcards.length === 0) return;

  const card = flashcards[currentCardIndex];
  document.querySelector('.question').textContent = card.question;
  document.querySelector('.hint').textContent = card.hint;
  document.querySelector('.answer').textContent = card.answer;
  document.querySelector('.explanation').innerHTML = `
    ${card.explanation}
    <div class="source"><p>${formatTime(card.timestamp)}</p></div>
  `;

  // Reset trạng thái flashcard
  const flashcardElement = document.querySelector('.flashcard');
  flashcardElement.classList.remove('flipped');
  document.querySelector('.hint').style.display = 'none';
  document.querySelector('.explanation').style.display = 'none';

  // Cập nhật bộ đếm thẻ
  document.getElementById('cardCounter').textContent = `${currentCardIndex + 1}/${flashcards.length}`;

  // Thêm sự kiện click cho phần "source"
  const sourceElement = document.querySelector('.source');
  if (sourceElement && player && typeof player.seekTo === "function") {
    sourceElement.style.cursor = 'pointer';
    sourceElement.addEventListener('click', () => {
      player.seekTo(card.timestamp, true);
      player.playVideo();
    });
  }
}

loadVideo();

================================================
File: server.js
================================================
import express from 'express';
import cors from 'cors';
import { YoutubeTranscript } from 'youtube-transcript';

const app = express();
const port = 3000;

// Enable CORS for all routes
app.use(cors({
  origin: [
    'http://localhost:3000',
    'http://localhost:5500',
    'https://open-youlearnai.vercel.app'
  ],
  methods: ['GET', 'POST'],
  credentials: true
}));

app.get('/api/transcript/:videoId', async (req, res) => {
  try {
    const { videoId } = req.params;
    const transcript = await YoutubeTranscript.fetchTranscript(videoId);
    res.json(transcript);
  } catch (error) {
    console.error('Error fetching transcript:', error);
    res.status(500).json({ error: 'Failed to fetch transcript' });
  }
});

app.listen(port, () => {
  console.log(`Proxy server running at http://localhost:${port}`);
});

================================================
File: styles.css
================================================
:root {
  --background: #ffffff;
  --foreground: #0f172a;
  --card: #ffffff;
  --card-foreground: #0f172a;
  --popover: #ffffff;
  --popover-foreground: #0f172a;
  --primary: #000000;
  --primary-foreground: #ffffff;
  --secondary: #f1f5f9;
  --secondary-foreground: #0f172a;
  --muted: #f1f5f9;
  --muted-foreground: #64748b;
  --accent: #f1f5f9;
  --accent-foreground: #0f172a;
  --border: #e2e8f0;
  --input: #e2e8f0;
  --ring: #000000;
  --radius: 0.65rem;
  /* Base font sizes */
  --font-size-xs: 0.75rem;    /* 12px */
  --font-size-sm: 0.875rem;   /* 14px */
  --font-size-base: 1rem;     /* 16px */
  --font-size-lg: 1.125rem;   /* 18px */
  --font-size-xl: 1.25rem;    /* 20px */
  --font-size-2xl: 1.5rem;    /* 24px */
}

.dark {
  --background: #000000;
  --foreground: #ffffff;
  --card: #121212;
  --card-foreground: #ffffff;
  --popover: #121212;
  --popover-foreground: #ffffff;
  --primary: #FFFFFF;
  --primary-foreground: #ffffff;
  --secondary: #1e1e1e;
  --secondary-foreground: #ffffff;
  --muted: #1e1e1e;
  --muted-foreground: #94a3b8;
  --accent: #1e1e1e;
  --accent-foreground: #ffffff;
  --border: #1e1e1e;
  --input: #1e1e1e;
  --ring: #FFFFFF;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* Base typography */
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  background-color: var(--background);
  color: var(--foreground);
  line-height: 1.5;
  font-size: var(--font-size-base);
}

.app-container {
  display: flex;
  height: 100vh;
}

.sidebar {
  width: 250px;
  background-color: var(--card);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  transition: all 0.3s ease;
  position: relative;
  z-index: 10;
}

.sidebar.collapsed {
  width: 65px;
}

.sidebar.collapsed .logo,
.sidebar.collapsed .btn span {
  display: none;
}
.sidebar.collapsed .btn-ghost{
  display: flex;
  justify-content: center;
  align-items: center;
}

.sidebar-header {
  padding: 0.65rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* Logo size */
.logo {
  font-size: var(--font-size-2xl);
  font-weight: 700;
  color: var(--foreground);
}

.sidebar-nav {
  flex: 1;
  padding: 0.65rem;
  overflow-y: auto;
}

.sidebar-footer {
  padding: 0.65rem;
}

/* Button text */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: flex-start;
  gap: 0.5rem;
  padding: 0.5rem;
  border-radius: var(--radius);
  font-size: var(--font-size-base);
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s;
  width: 100%;
  color: var(--foreground);
  position: relative;
  overflow: hidden;
}

.btn-ghost {
  background-color: transparent;
  border: none;
}

.btn-ghost:hover {
  background-color: var(--accent);
}

.btn-icon {
  padding: 0.25rem;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--foreground);
}

.main-content {
  flex: 1;
  display: flex;
  overflow: hidden;
  background-color: var(--background);
}

.left-panel {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 0;
  height: 100%;
}

.video-player {
  background-color: var(--card);
  margin: 0.65rem;
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  flex-shrink: 0;
}

.video-container {
  width: 100%;
  aspect-ratio: 16 / 9;
  position: relative;
  overflow: hidden;
}

.video-container iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
}

.transcript-chapters {
  flex: 1;
  display: flex;
  flex-direction: column;
  margin: 0.65rem;
  background-color: var(--card);
  border-radius: var(--radius);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  height: 0;
  min-height: 0;
  overflow: hidden;
}

.right-panel {
  width: 450px;
  background-color: var(--card);
  margin: 0.65rem;
  border-radius: var(--radius);
  display: flex;
  flex-direction: column;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.tabs {
  display: flex;
  background-color: var(--secondary);
  padding: 0.3rem;
  border-radius: var(--radius) var(--radius) 0 0;
  border-bottom: 1px solid var(--background);
}

/* Tab buttons */
.tab-btn {
  flex: 1;
  padding: 0.75rem 1rem;
  background: none;
  border: none;
  cursor: pointer;
  font-weight: 500;
  color: var(--muted-foreground);
  transition: color 0.2s, border-color 0.2s;
  border-radius: var(--radius);
  font-size: var(--font-size-base);
}

.tab-btn.active {
  color: var(--primary);
  /* border-bottom: 2px solid var(--primary); */
  background-color: var(--card);
}

/* Tab Content Styling */
.tab-content {
  display: none;
  height: calc(100% - 48px);
  overflow: hidden; /* Changed from overflow-y: auto */
}

.tab-content.active {
  display: flex;
  flex-direction: column;
}

/* Summary Tab Specific */
#summaryContent {
  flex: 1; /* Added */
  padding: 1rem;
  white-space: pre-wrap;
  line-height: 1.6;
  font-size: var(--font-size-base);
  overflow-y: auto;
}

/* Chat Tab Specific */
#chatContent {
  flex: 1;
  flex-direction: column;
}

/* Chat messages */
.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  font-size: var(--font-size-base);
}

/* Scrollbar styling cho cả hai tab */
.tab-content::-webkit-scrollbar,
.chat-messages::-webkit-scrollbar {
  width: 8px;
}

.tab-content::-webkit-scrollbar-track,
.chat-messages::-webkit-scrollbar-track {
  background: var(--secondary);
  border-radius: 4px;
}

.tab-content::-webkit-scrollbar-thumb,
.chat-messages::-webkit-scrollbar-thumb {
  background: var(--muted-foreground);
  border-radius: 4px;
}

/* Chapter list */
.chapter-list {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding: 1rem;
  overflow-y: auto;
  height: 100%;
}

.chapter {
  background-color: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1rem;
  transition: background-color 0.2s ease;
}

.chapter:hover {
  background-color: var(--accent);
  cursor: pointer;
}

.chapter h3 {
  font-size: var(--font-size-lg);
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--foreground);
}

.chapter p {
  font-size: var(--font-size-base);
  color: var(--muted-foreground);
  margin-bottom: 0.75rem;
  line-height: 1.5;
}

.chapter-timestamps {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  font-size: var(--font-size-sm);
}

.chapter-timestamps .timestamp {
  cursor: pointer;
}

.chapter-timestamps .timestamp:hover {
  background-color: var(--primary);
  color: var(--secondary);
}

.transcript {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  padding: 1rem;
  font-size: var(--font-size-base);
  line-height: 1.6;
}

.transcript p {
  display: flex;
  gap: 0.5rem;
  align-items: center; /* Changed from flex-start to center */
  padding: 0.5rem;
  border-radius: var(--radius);
  transition: background-color 0.2s ease;
  margin-bottom: 0.75rem;
  color: var(--foreground);
}

.gutter {
  background-color: var(--background);
  position: relative;
}

.gutter.gutter-horizontal {
  cursor: col-resize;
  width: 1px !important;
}

.gutter.gutter-horizontal:hover {
  background-color: var(--border);
}

.gutter.gutter-horizontal::after {
  content: "";
  position: absolute;
  top: 0;
  left: -4px;
  width: 8px;
  height: 100%;
  background-color: transparent;
}

@media (max-width: 768px) {
  .app-container {
    flex-direction: column;
  }

  .sidebar {
    width: 100%;
    height: auto;
  }

  .main-content {
    flex-direction: column;
  }

  .right-panel {
    width: auto;
    min-width: 0;
  }
}

.btn:focus,
.tab-btn:focus {
    outline: none;
}

.btn:focus:not(:focus-visible),
.tab-btn:focus:not(:focus-visible) {
    outline: none;
}

.btn:focus-visible,
.tab-btn:focus-visible {
    outline: 2px solid var(--ring);
    outline-offset: -2px;
}

.transcript p:hover {
  background-color: var(--accent);
  cursor: pointer;
}

.timestamp {
  background-color: var(--secondary);
  color: var(--secondary-foreground);
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius);
  font-size: 0.875rem;
  font-weight: 500;
  white-space: nowrap;
  transition: background-color 0.2s ease;
}

.transcript p:hover .timestamp {
  background-color: var(--primary);
  color: var(--secondary);
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  background: var(--bg);
}

::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 30px;
}

.ai-section {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.chat-input-container {
  display: flex;
  gap: 0.5rem;
  padding: 0.75rem;
  border-top: 1px solid var(--border);
  margin-top: auto;
}

/* Chat input */
.chat-input {
  flex: 1;
  padding: 0.75rem;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background-color: var(--background);
  color: var(--foreground);
  font-size: var(--font-size-base);
  font-weight: 500;
}

.chat-input:focus {
  outline: none;
  border-color: var(--border);
}

.chat-send {
  padding: 0.75rem 1rem;
  background-color: var(--foreground);
  color: var(--background);
  border: none;
  cursor: pointer;
  font-size: 0.875rem;
  font-weight: 500;
  border-radius: var(--radius);
  transition: transform 0.5s ease;
}

.chat-send:hover {
  transform: scale(1.05);
}

.message {
  padding: 0.75rem 1rem;
  border-radius: var(--radius);
  max-width: 85%;
  font-size: 0.875rem;
  line-height: 1.5;
  background-color: var(--secondary);
  font-size: var(--font-size-base);
  max-width: 100%;
}

.user {
  align-self: flex-end;
  background-color: transparent;
  border: 2px solid var(--border);
  color: var(--foreground);
}

.bot {
  align-self: flex-start;
  background-color: var(--secondary);
  color: var(--foreground);
}

/* Summary and Flashcard content */
#summaryContent p,
#flashcardContent p,
.message p {
  font-size: var(--font-size-base);
  line-height: 1.6;
}

/* Markdown Content Styling */
#summaryContent {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  color: var(--foreground);
  line-height: 1.6;
  margin: 0.5rem;
}

/* Lists */
#summaryContent ul,
.message ul {
  margin: 0;
  margin-top: 0.75rem;
  margin-bottom: 0.75rem;
  padding: 0;
  padding-left: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

#summaryContent li,
.message li {
  margin: 1px 0;
  position: relative;
}

#summaryContent li::marker,
.message li::marker {
  color: var(--muted-foreground);
}

/* Emphasis */
#summaryContent strong,
.message strong {
  color: var(--foreground);
  font-weight: 600;
  background: var(--secondary);
  padding: 0.1em 0.4em;
  border-radius: 4px;
}

#summaryContent em,
.message em {
  font-style: italic;
  color: var(--muted-foreground);
}

/* Paragraphs */
#summaryContent p {
  margin: 1rem 0;
}

/* Blockquotes */
#summaryContent blockquote,
.message blockquote {
  margin: 1rem 0;
  padding: 0.5rem 1rem;
  border-left: 4px solid var(--border);
  background: var(--secondary);
  border-radius: 0 var(--radius) var(--radius) 0;
}

/* Code blocks */
#summaryContent pre,
.message pre {
  color: var(--foreground);
  background: var(--background);
  padding: 1rem;
  border-radius: var(--radius);
  overflow-x: auto;
  white-space: pre;
  -webkit-overflow-scrolling: touch;
  margin: 10px 0;
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* IE and Edge */
  border: 1px solid var(--border);
}

#summaryContent pre::-webkit-scrollbar,
.message pre::-webkit-scrollbar {
  display: none; /* Chrome, Safari and Opera */
}

#summaryContent code,
.message code {
  color: var(--foreground);
  font-family: ui-monospace, monospace;
  font-size: 0.9em;
  padding: 0.2em 0.4em;
  background: var(--background);
  border-radius: var(--radius);
  display: inline-block;
  max-width: 100%;
  border: 1px solid var(--border);
}

.message pre code {
  padding: 0;
  background: none;
  border: none;
}

.btn.btn-ghost svg {
  transition: transform 1s ease;
}

.chapter-item {
  background-color: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1rem;
  margin-bottom: 0.5rem;
  transition: background-color 0.2s ease;
}

.chapter-item:hover {
  background-color: var(--accent);
}

.chapter-header {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  margin-bottom: 0.5rem;
  color: var(--muted-foreground);
  font-size: var(--font-size-sm);
}

.chapter-content h3 {
  font-size: var(--font-size-lg);
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--foreground);
}

.chapter-content p {
  font-size: var(--font-size-base);
  color: var(--muted-foreground);
  line-height: 1.5;
}

.loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
  color: #666;
  pointer-events: none;
  opacity: 0.7;
}

.loading::after {
  content: '';
  width: 1rem;
  height: 1rem;
  margin-left: 0.5rem;
  border: 2px solid #666;
  border-radius: 50%;
  border-right-color: transparent;
  animation: spin 1s linear infinite;
}

.error {
  padding: 1rem;
  color: #dc3545;
  background-color: rgba(220, 53, 69, 0.1);
  border-radius: 4px;
  text-align: center;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Hiệu ứng typing cho stream */
.message.bot {
  position: relative;
}

.message.bot:last-child::after {
  content: '|';
  position: absolute;
  right: -2px;
  bottom: 0;
  animation: blink 1s infinite;
}

@keyframes blink {
  50% { opacity: 0; }
}

/* Flashcard styles */
#flashcardContainer {
    display: flex;
    flex-direction: column-reverse;
    align-items: center;
    justify-content: center;
    height: calc(100% - 48px); /* Trừ đi chiều cao của tabs */
    padding: 1rem;
}

#flashcardControls {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 1.5rem;
    width: 100%;
    max-width: 500px;
}
#flashcardControls .btn {
  display: flex;
  justify-content: center;
  align-items: center;
}

#cardCounter {
    font-size: var(--font-size-sm);
    color: var(--muted-foreground);
    min-width: 60px;
    text-align: center;
}

.flashcard {
    width: 100%;
    max-width: 500px;
    min-height: 350px;
    height: fit-content;
    perspective: 1000px;
    margin: 0 auto;
}

.flashcard-inner {
    position: relative;
    width: 100%;
    height: 100%;
    text-align: center;
    transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    transform-style: preserve-3d;
    cursor: pointer;
    transform-origin: center;
}

.flashcard.flipped .flashcard-inner {
    transform: rotateY(180deg);
}

.flashcard-front, 
.flashcard-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 2rem;
    background: var(--card);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.flashcard-back {
    transform: rotateY(180deg);
}

.question, 
.answer {
    font-size: var(--font-size-xl);
    font-weight: 600;
    color: var(--foreground);
    margin-bottom: 1.5rem;
    line-height: 1.4;
    max-width: 100%;
}

.hint, 
.explanation {
    display: none;
    margin: 1rem 0;
    font-style: italic;
    color: var(--muted-foreground);
    font-size: var(--font-size-base);
    line-height: 1.6;
    padding: 1rem;
    border-radius: var(--radius);
    background: var(--secondary);
    width: 100%;
    max-width: 400px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.hint[style*="display: block"],
.explanation[style*="display: block"] {
    animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.source {
    font-size: var(--font-size-sm);
    font-style: normal;
    font-weight: bold;
    color: var(--muted-foreground);
    margin-top: 0.5rem;
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius);
    background: var(--secondary);
}

.source p {
    background-color: var(--background);
    padding: 0.2rem 0.5rem;
    border-radius: var(--radius);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    width: fit-content;
    margin: 0 auto;
}

/* Thêm animation cho flashcard */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Cải thiện nút trong flashcard */
.flashcard .btn {
    font-size: var(--font-size-sm);
    padding: 0.5rem 1rem;
    margin: 0.5rem;
    background: var(--secondary);
    color: var(--foreground);
    border: 1px solid var(--border);
    transition: all 0.2s ease;
}

.flashcard .btn:hover {
    background: var(--accent);
    transform: translateY(-1px);
}

.flashcard .btn:active {
    transform: translateY(0);
}

/* Styling cho bảng trong chat và summary */
#summaryContent table,
.message table {
    width: 100%;
    margin: 1rem 0;
    border-collapse: collapse;
    background: var(--card);
    border-radius: var(--radius);
    overflow: hidden;
    font-size: var(--font-size-sm);
    border: 2px solid var(--border);
}

#summaryContent th,
#summaryContent td,
.message th,
.message td {
    padding: 0.75rem 1rem;
    text-align: left;
    border: 1px solid var(--border);
}

#summaryContent th,
.message th {
    background: var(--accent);
    color: var(--accent-foreground);
    font-weight: 600;
    font-size: var(--font-size-sm);
    letter-spacing: 0.05em;
}

/* Responsive table */
@media screen and (max-width: 768px) {
    #summaryContent table,
    .message table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
}

/* Caption cho bảng */
#summaryContent table caption,
.message table caption {
    padding: 0.5rem;
    font-style: italic;
    text-align: center;
    color: var(--muted-foreground);
    font-size: var(--font-size-sm);
}

/* Responsive table */
@media screen and (max-width: 768px) {
    #summaryContent table,
    .message table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    #summaryContent th,
    #summaryContent td,
    .message th,
    .message td {
        white-space: nowrap;
        min-width: 120px;
    }
}

/* Scrollbar cho bảng khi overflow */
#summaryContent table::-webkit-scrollbar,
.message table::-webkit-scrollbar {
    height: 8px;
}

#summaryContent table::-webkit-scrollbar-track,
.message table::-webkit-scrollbar-track {
    background: var(--secondary);
    border-radius: 4px;
}

#summaryContent table::-webkit-scrollbar-thumb,
.message table::-webkit-scrollbar-thumb {
    background: var(--muted-foreground);
    border-radius: 4px;
}

/* Caption cho bảng */
#summaryContent table caption,
.message table caption {
    padding: 0.5rem;
    font-style: italic;
    text-align: center;
    color: var(--muted-foreground);
    font-size: var(--font-size-sm);
}

/* Regenerate Button Styles */
.regenerate-btn {
  display: flex;
  align-items: center;
  justify-content: flex-start; /* Added: align content to the left */
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  margin: 1rem;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--foreground);
  font-size: var(--font-size-base);
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

.regenerate-btn:hover {
  background: var(--accent);
  transform: translateY(-1px);
}

.regenerate-btn i {
  font-size: 1.2em;
}

.regenerate-btn.loading {
  pointer-events: none;
  background: transparent;
  transform: scale(1.02);
}

.regenerate-btn.loading .galaxy-spinner {
  opacity: 1;
}

.regenerate-btn.loading span,
.regenerate-btn.loading i {
  opacity: 0.5;
}

/* Remove old galaxy effect styles */
.galaxy-effect,
.galaxy-effect::before,
.galaxy-spinner,
.galaxy-spinner::before,
.galaxy-spinner::after {
  display: none;
}

/* New simple generate spinner */
.generate-spinner {
  border: 4px solid var(--border);
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  width: 24px;
  height: 24px;
  animation: spin 1s linear infinite;
}

.btn::before {
  transition: opacity 0.3s ease;
}

@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.flashcard-inner.slide {
  animation: slideIn 0.5s ease-out;
}

.summary-btn{
  margin: 0;
}

================================================
File: test.html
================================================
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>
</head>
<body>
    <div id="messages" style="height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;"></div>
    <input id="input" type="text" placeholder="Nhập tin nhắn...">
    <button id="send">Gửi</button>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        const apiKey = "AIzaSyDKuUZczmcIsNg8ewNnZzEBv0eNnNFgPkE";
        const genAI = new GoogleGenerativeAI(apiKey);
        const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash" });
        let chatSession = model.startChat({ history: [] });

        document.addEventListener("DOMContentLoaded", () => {
            const input = document.getElementById("input");
            const sendBtn = document.getElementById("send");
            const messages = document.getElementById("messages");

            function addMessage(text, isUser) {
                const div = document.createElement("div");
                div.textContent = text;
                div.style.textAlign = isUser ? "right" : "left";
                messages.appendChild(div);
                messages.scrollTop = messages.scrollHeight;
            }

            async function sendMessage() {
                const text = input.value.trim();
                if (!text) return;
                addMessage(text, true);
                input.value = "";
                
                const response = await chatSession.sendMessageStream(text);
                let reply = "";
                for await (const chunk of response.stream) {
                    reply += chunk.text();
                }
                addMessage(reply, false);
            }

            sendBtn.addEventListener("click", sendMessage);
            input.addEventListener("keydown", (e) => {
                if (e.key === "Enter") sendMessage();
            });
        });
    </script>
</body>
</html>


================================================
File: test.js
================================================
import { YoutubeTranscript } from 'youtube-transcript';

YoutubeTranscript.fetchTranscript('bWmBf__1wv8')
  .then(transcript => {
    console.log(transcript);
  })
  .catch(error => {
    console.error('Error fetching transcript:', error);
  });


================================================
File: vercel.json
================================================
{
  "version": 2,
  "builds": [
    { "src": "*.html", "use": "@vercel/static" },
    { "src": "api/**/*.js", "use": "@vercel/node" },
    { "src": "*.{css,svg,js}", "use": "@vercel/static" }
  ],
  "rewrites": [
    { "source": "/api/transcript/:videoId", "destination": "/api/transcript/[videoId]" },
    { "source": "/api/:path*", "destination": "/api/:path*" }
  ],
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        { "key": "Access-Control-Allow-Credentials", "value": "true" },
        { "key": "Access-Control-Allow-Origin", "value": "*" },
        { "key": "Access-Control-Allow-Methods", "value": "GET,OPTIONS,PATCH,DELETE,POST,PUT" },
        { "key": "Access-Control-Allow-Headers", "value": "X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version" }
      ]
    }
  ]
}

================================================
File: api/transcript/[videoId].js
================================================
import { YoutubeTranscript } from 'youtube-transcript';

export const config = {
  runtime: 'edge',
  regions: ['iad1'],
};

export default async function handler(req) {
  try {
    const url = new URL(req.url);
    const videoId = url.pathname.split('/').pop();
    
    if (!videoId) {
      return new Response(JSON.stringify({ error: 'Missing videoId' }), {
        status: 400,
        headers: {
          'Content-Type': 'application/json',
          'Access-Control-Allow-Origin': '*',
        },
      });
    }

    const transcript = await YoutubeTranscript.fetchTranscript(videoId);
    
    return new Response(JSON.stringify(transcript), {
      status: 200,
      headers: {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': '*',
      },
    });
  } catch (error) {
    console.error('Error fetching transcript:', error);
    return new Response(JSON.stringify({ error: 'Failed to fetch transcript' }), {
      status: 500,
      headers: {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': '*',
      },
    });
  }
}

================================================
File: .vercel/README.txt
================================================
> Why do I have a folder named ".vercel" in my project?
The ".vercel" folder is created when you link a directory to a Vercel project.

> What does the "project.json" file contain?
The "project.json" file contains:
- The ID of the Vercel project that you linked ("projectId")
- The ID of the user or team your Vercel project is owned by ("orgId")

> Should I commit the ".vercel" folder?
No, you should not share the ".vercel" folder with anyone.
Upon creation, it will be automatically added to your ".gitignore" file.


================================================
File: .vercel/project.json
================================================
{"projectId":"prj_WdDIzLeV3lRszo4gnQVrmY2mXFgc","orgId":"team_lcYjl949lT0eWPQD9If9LEjk"}

